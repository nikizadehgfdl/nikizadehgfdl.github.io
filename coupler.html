<!DOCTYPE html>
<html>
<head>
  <title>Bootstrap Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
<div id="accordion">

  <div class="card">
    <div class="card-header" id="heading-00">
      <h5 class="mb-0">
        <a class="card-link" role="button" data-toggle="collapse" href="#collapse-00" aria-expanded="false" aria-controls="collapse-00">
call fms_init
        </a>
      </h5>
    </div>
    <div id="collapse-00" class="collapse" aria-labelledby="heading-00">
      <div class="card-body">
call fms_init
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header" id="heading-0">
      <h5 class="mb-0">
        <a class="card-link" role="button" data-toggle="collapse" href="#collapse-0" aria-expanded="false" aria-controls="collapse-0">
        call coupler_init()
        </a>
      </h5>
    </div>
    <div id="collapse-0" class="collapse" aria-labelledby="heading-0">
      <div class="card-body">
        Initialize coupler and components
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header" id="heading-1">
      <h5 class="mb-0">
        <a role="button" data-toggle="collapse" href="#collapse-1" aria-expanded="true" aria-controls="collapse-1">
          Main loop: do nc = 1, num_cpld_calls
        </a>
      </h5>
    </div>
    <div id="collapse-1" class="collapse" aria-labelledby="heading-1">
      <div class="card-body">

        <div id="accordion-1">
          <div class="card">
            <div class="card-header" id="heading-1-1">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-1" aria-expanded="false" aria-controls="collapse-1-1">
Exchange boundary fluxes from ocean to ice and from ice to ocean
               </a>
              </h5>
            </div>
            <div id="collapse-1-1" class="collapse" aria-labelledby="heading-1-1">
              <div class="card-body">
<ul>
  <h2><a href="https://github.com/nikizadehgfdl/FMScoupler/blob/nikizadehgfdl-coupler-html/full/coupler_main.F90#L713">Exchange fluxes between OCN and ICE</a></h2>
</ul>
		      
if (Ice%slow_ice_PE .or. Ocean%is_ocean_pe): </p>
        call mpp_set_current_pelist(slow_ice_ocean_pelist)</p>
        call flux_ocean_to_ice( Time, Ocean, Ice, Ocean_ice_boundary )</p>
        call flux_ice_to_ocean( Time, Ice, Ocean, Ice_ocean_boundary ) if(use_lag_fluxes)</p>

If the slow ice is on a subset of the ocean PEs, use the ocean PElist.</p>
Redistribute quantities from Ocean to Ocean_ice_boundary basically Ocean_ice_boundary%* = Ocean%* </p>
Redistribute quantities from Ice   to Ice_ocean_boundary basically Ice_ocean_boundary%* = Ice%*   </p>
The first iteration is supplied by restarts</p>
Note: Ocean_ice_boundary is a type from Ice   model, it is the skin of Ice</p>
Note: Ice_ocean_boundary is a type from Ocean model, it is the skin of Ocean</p>
Note: Extra unnamed coupler fluxes are copied/distributed too: call coupler_type_redistribute_data￼</p>
ToDo: Document how to add a "coupler flux". </p>
              </div>
            </div>  
          </div>
          <div class="card">
            <div class="card-header" id="heading-1-2">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-2" aria-expanded="false" aria-controls="collapse-1-2">
Pre-fast-ATM-loop
                </a>
              </h5>
            </div>
            <div id="collapse-1-2" class="collapse"  aria-labelledby="heading-1-2">
              <div class="card-body">
Exchange from slow to fast Ice. This could be a point where the model is serialized if the fast and slow ice are on different PEs. </p>
call exchange_slow_to_fast_ice(Ice)</p>
if (Atm%pe):</p>
	call generate_sfc_xgrid( Land, Ice ) ! regenerate exchange grid eliminating side 2 tiles with 0 frac area.</p>
	call send_ice_mask_sic(Time)</p>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="heading-1-3">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3" aria-expanded="false" aria-controls="collapse-1-3">
fast-ATM-loop: do na = 1, num_atmos_calls
                </a>
              </h5>
            </div>
            <div id="collapse-1-3" class="collapse" aria-labelledby="heading-1-3">
              <div class="card-body">
                  <div id="accordion-1-3">
                    <div class="card">
                      <div class="card-header" id="heading-1-3-1">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-1" aria-expanded="false" aria-controls="collapse-1-3-1">
call atmos_tracer_driver_gather_data(Atm%fields, Atm%tr_bot)
                          </a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-1" class="collapse"  aria-labelledby="heading-1-3-1">
                        <div class="card-body">
call atmos_tracer_driver_gather_data(Atm%fields, Atm%tr_bot)
                        </div>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-header" id="heading-1-3-2">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-2" aria-expanded="false" aria-controls="collapse-1-3-2">
call sfc_boundary_layer( REAL(dt_atmos), Time_atmos, Atm, Land, Ice, Land_ice_atmos_boundary )
                          </a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-2" class="collapse"  aria-labelledby="heading-1-3-2">
                        <div class="card-body">
call sfc_boundary_layer( REAL(dt_atmos), Time_atmos, Atm, Land, Ice, Land_ice_atmos_boundary )
     
     
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-3">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-3" aria-expanded="false" aria-controls="collapse-1-3-3">
call update_atmos_model_dynamics( Atm )
                          </a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-3" class="collapse"  aria-labelledby="heading-1-3-3">
                        <div class="card-body">
call update_atmos_model_dynamics( Atm )
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-4">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-4" aria-expanded="false" aria-controls="collapse-1-3-4">
call update_atmos_model_radiation( Land_ice_atmos_boundary, Atm )
                          </a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-4" class="collapse"  aria-labelledby="heading-1-3-4">
                        <div class="card-body">
call update_atmos_model_radiation( Land_ice_atmos_boundary, Atm ) Serial
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-5">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-5" aria-expanded="false" aria-controls="collapse-1-3-5">
call update_atmos_model_down( Land_ice_atmos_boundary, Atm )</a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-5" class="collapse"  aria-labelledby="heading-1-3-5">
                        <div class="card-body">
call update_atmos_model_down( Land_ice_atmos_boundary, Atm )
     call physics_driver_down(arrays not types)
          call atmos_tracer_driver
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-6">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-6" aria-expanded="false" aria-controls="collapse-1-3-6">call flux_down_from_atmos￼( Time_atmos, Atm, Land, Ice, &
                                     Land_ice_atmos_boundary, &
                                     Atmos_land_boundary, &
                                     Atmos_ice_boundary )
                          </a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-6" class="collapse"  aria-labelledby="heading-1-3-6">
                        <div class="card-body">
call flux_down_from_atmos( Time_atmos, Atm, Land, Ice, &
                                     Land_ice_atmos_boundary, &
                                     Atmos_land_boundary, &
                                     Atmos_ice_boundary )
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-7">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-7" aria-expanded="false" aria-controls="collapse-1-3-7">call update_land_model_fast￼( Atmos_land_boundary, Land )
                          </a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-7" class="collapse"  aria-labelledby="heading-1-3-7">
                        <div class="card-body">
call update_land_model_fast( Atmos_land_boundary, Land )
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-8">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-8" aria-expanded="false" aria-controls="collapse-1-3-8">
call update_ice_model_fast( Atmos_ice_boundary, Ice )</a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-8" class="collapse"  aria-labelledby="heading-1-3-8">
                        <div class="card-body">
call update_ice_model_fast( Atmos_ice_boundary, Ice )
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-9">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-9" aria-expanded="false" aria-controls="collapse-1-3-9">
call flux_up_to_atmos( Time_atmos, Land, Ice, Land_ice_atmos_boundary, &
                                 Atmos_land_boundary, Atmos_ice_boundary )</a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-9" class="collapse"  aria-labelledby="heading-1-3-9">
                        <div class="card-body">
call flux_up_to_atmos( Time_atmos, Land, Ice, Land_ice_atmos_boundary, &
                                 Atmos_land_boundary, Atmos_ice_boundary )
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-10">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-10" aria-expanded="false" aria-controls="collapse-1-3-10">call update_atmos_model_up( Land_ice_atmos_boundary, Atm)
</a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-10" class="collapse"  aria-labelledby="heading-1-3-10">
                        <div class="card-body">
call update_atmos_model_up( Land_ice_atmos_boundary, Atm)
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-11">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-11" aria-expanded="false" aria-controls="collapse-1-3-11">call flux_atmos_to_ocean￼(Time_atmos, Atm, Atmos_ice_boundary, Ice)
</a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-11" class="collapse"  aria-labelledby="heading-1-3-11">
                        <div class="card-body">
call flux_atmos_to_ocean(Time_atmos, Atm, Atmos_ice_boundary, Ice)
     call atmos_tracer_driver_gather_data_down(Atm%fields, Atm%tr_bot)
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-12">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-12" aria-expanded="false" aria-controls="collapse-1-3-12">call flux_ex_arrays_dealloc
</a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-12" class="collapse"  aria-labelledby="heading-1-3-12">
                        <div class="card-body">
call flux_ex_arrays_dealloc
                        </div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header" id="heading-1-3-13">
                        <h5 class="mb-0">
                          <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-3-13" aria-expanded="false" aria-controls="collapse-1-3-13">call update_atmos_model_state( Atm )
</a>
                        </h5>
                      </div>
                      <div id="collapse-1-3-13" class="collapse"  aria-labelledby="heading-1-3-13">
                        <div class="card-body">
call update_atmos_model_state( Atm )
                        </div>
                      </div>
                    </div>

                  </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header" id="heading-1-30">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-30" aria-expanded="false" aria-controls="collapse-1-30">call update_land_model_slow￼(Atmos_land_boundary,Land)
                </a>
              </h5>
            </div>
            <div id="collapse-1-30" class="collapse"  aria-labelledby="heading-1-30">
              <div class="card-body">
call update_land_model_slow(Atmos_land_boundary,Land)
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header" id="heading-1-4">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-4" aria-expanded="false" aria-controls="collapse-1-4">call flux_land_to_ice￼( Time, Land, Ice, Land_ice_boundary )
                </a>
              </h5>
            </div>
            <div id="collapse-1-4" class="collapse"  aria-labelledby="heading-1-4">
              <div class="card-body">
call flux_land_to_ice( Time, Land, Ice, Land_ice_boundary )
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header" id="heading-1-5">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-5" aria-expanded="false" aria-controls="collapse-1-5">update_ice_model_slow
                </a>
              </h5>
            </div>
            <div id="collapse-1-5" class="collapse"  aria-labelledby="heading-1-5">
              <div class="card-body">
call ice_model_fast_cleanup(Ice)</p>
call unpack_land_ice_boundary(Ice, Land_ice_boundary)</p>
call exchange_fast_to_slow_ice(Ice)</p>
call update_ice_model_slow(Ice)</p>

              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header" id="heading-1-6">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-6" aria-expanded="false" aria-controls="collapse-1-6">call update_ocean_model￼( Ice_ocean_boundary, Ocean_state,  Ocean, Time_ocean, Time_step_cpld )
                </a>
              </h5>
            </div>
            <div id="collapse-1-5" class="collapse"  aria-labelledby="heading-1-5">
              <div class="card-body">
call flux_ice_to_ocean_finish(Time_flux_ice_to_ocean, Ice_ocean_boundary)</p>
  !> flux_ice_to_ocean_finish carrries out a final set of tasks that should only occur on</p>
  !! the ocean processors, including data override and perhaps saving diagnostics.</p>
  E.g.,  call data_override('OCN', 'u_flux',    Ice_Ocean_Boundary%u_flux   , Time )</p>
  Extra fluxes  call coupler_type_data_override('OCN', Ice_Ocean_Boundary%fluxes, Time )</p>
if (combined_ice_and_ocean) call update_slow_ice_and_ocean</p>
call update_ocean_model( Ice_ocean_boundary, Ocean_state,  Ocean, Time_ocean, Time_step_cpld )</p>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header" id="heading-1-6">
              <h5 class="mb-0">
                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-1-6" aria-expanded="false" aria-controls="collapse-1-6">write out intermediate restart file when needed
                </a>
              </h5>
            </div>
            <div id="collapse-1-6" class="collapse"  aria-labelledby="heading-1-6">
              <div class="card-body">
call atmos_model_restart(Atm, timestamp)</p>
call land_model_restart(timestamp)</p>
call ice_model_restart(Ice, timestamp)</p>
call ocean_model_restart(Ocean_state, timestamp)</p>
call coupler_restart(Time, Time_restart_current, timestamp)</p>
              </div>
            </div>
          </div>

        </div>      
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-header" id="heading-2">
      <h5 class="mb-0">
        <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
call coupler_end 
        </a>
      </h5>
    </div>
    <div id="collapse-2" class="collapse" data-parent="#accordion" aria-labelledby="heading-2">
      <div class="card-body">
call coupler_end
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-header" id="heading-3">
      <h5 class="mb-0">
        <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
call fms_end
        </a>
      </h5>
    </div>
    <div id="collapse-3" class="collapse" aria-labelledby="heading-3">
      <div class="card-body">
call fms_end
      </div>
    </div>
  </div>
</div>


